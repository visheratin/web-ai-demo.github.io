(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[291],{8594:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/demos/segmentation",function(){return s(3662)}])},3662:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var n=s(5893),i=s(5817),a=s(9008),c=s.n(a),l=s(7294),r=s(4540),o=s(5108);function d(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),s=(0,l.useRef)(null),a=(0,l.useRef)(null),[d,h]=(0,l.useState)({width:0,height:0,aspectRatio:1}),m=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e.current&&s.current){let n=s.current.offsetWidth-11;h({width:n=n>800?800:n,height:n*t,aspectRatio:t})}},[g,u]=(0,l.useState)({value:"none"});(0,l.useEffect)(()=>{m(),v()},[]);let[f,p]=(0,l.useState)(new r.s_({id:"segformer-b0-segmentation-quant",type:r.p8.Segmentation,modelPath:"",configPath:"",preprocessorPath:""})),[x,w]=(0,l.useState)({message:"ready",processing:!1}),v=async()=>{w({message:"loading the model",processing:!0});let e=await r.V6.create("segformer-b0-segmentation-quant");p(e.model),w({message:"ready",processing:!1})},j=()=>{if(a.current&&a.current.files&&a.current.files[0]){var e=new FileReader;e.onload=async()=>{y(e.result)},e.readAsArrayBuffer(a.current.files[0])}},N=()=>{let t=e.current,s=t.getContext("2d");s.clearRect(0,0,t.width,t.height)},b=t=>{let s=e.current,n=s.getBoundingClientRect(),i=s.getContext("2d"),a=t.clientX-n.left,c=t.clientY-n.top,l=i.getImageData(a,c,1,1).data,r=f.getClass(l);u({value:r})},y=async s=>{w({processing:!0,message:"processing the image"});var n=await i.Z.read(s);m(n.bitmap.height/n.bitmap.width);let a=new ImageData(new Uint8ClampedArray(n.bitmap.data),n.bitmap.width,n.bitmap.height),c=document.createElement("canvas");c.width=n.bitmap.width,c.height=n.bitmap.height;let l=c.getContext("2d");l.putImageData(a,0,0),t.current.src=c.toDataURL("image/png"),N();let r=await f.process(s);o.log("Inference finished in ".concat(r.elapsed," seconds."));let d=e.current;var h=d.getContext("2d");h.globalAlpha=.4,h.drawImage(r.canvas,0,0,r.canvas.width,r.canvas.height,0,0,d.width,d.height),w({processing:!1,message:"ready"})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(c(),{children:[(0,n.jsx)("title",{children:"Web AI Next.js segmentation example"}),(0,n.jsx)("meta",{name:"description",content:"Web AI Next.js segmentation example"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,n.jsx)("main",{children:(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("div",{className:"row",children:(0,n.jsx)("div",{className:"col",children:(0,n.jsx)("h2",{children:"Image segmentation"})})}),(0,n.jsx)("div",{className:"row",children:(0,n.jsx)("div",{className:"col",children:(0,n.jsx)("div",{className:"d-flex align-items-center",children:(0,n.jsxs)("strong",{children:["Status: ",x.message]})})})}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsxs)("div",{className:"col-md-6 col-sm-12",children:[(0,n.jsxs)("div",{ref:s,style:{position:"relative",height:d.height},children:[(0,n.jsx)("img",{ref:t,width:d.width,height:d.height,style:{position:"absolute",top:0,left:0}}),(0,n.jsx)("canvas",{ref:e,width:d.width,height:d.height,style:{position:"absolute",top:0,left:0},onClick:b,onTouchEnd:b})]}),(0,n.jsxs)("h6",{className:"center-align",children:["Selected class: ",g.value]})]}),(0,n.jsx)("div",{className:"col-md-6 col-sm-12",children:(0,n.jsxs)("form",{action:"#",onSubmit:e=>e.preventDefault(),children:[(0,n.jsx)("h6",{children:"Select the image"}),(0,n.jsx)("div",{className:"row",children:(0,n.jsx)("div",{className:"mb-3",children:(0,n.jsx)("input",{className:"form-control",type:"file",ref:a,onChange:j,disabled:x.processing})})})]})})]})]})})]})}},2987:function(){},8104:function(){},3731:function(){}},function(e){e.O(0,[770,655,362,444,774,888,179],function(){return e(e.s=8594)}),_N_E=e.O()}]);