(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[84],{7562:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/demos/object-detection",function(){return s(519)}])},519:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var i=s(5893),n=s(9008),l=s.n(n),r=s(5817),c=s(7294),a=s(4540),o=s(5108);function d(){let e=(0,c.useRef)(null),t=(0,c.useRef)(null),s=(0,c.useRef)(null),n=(0,c.useRef)(null),[d,h]=(0,c.useState)({width:0,height:0,aspectRatio:1}),u=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e.current){let s=e.current.offsetWidth-11;s=s>800?800:s;let i=s,n=s*t;return h({width:i,height:n,aspectRatio:t}),[i,n]}return[]};(0,c.useEffect)(()=>{u(),x()},[]);let[m,f]=(0,c.useState)({results:[]}),[g,j]=(0,c.useState)({}),x=async()=>{w({message:"loading the model",processing:!0});let e=await a.V6.create("yolos-tiny-quant");j({instance:e.model}),w({message:"ready",processing:!1})},[p,w]=(0,c.useState)({message:"ready",processing:!1}),b=()=>{if(n.current&&n.current.files&&n.current.files[0]){var e=new FileReader;e.onload=async()=>{N(e.result)},e.readAsArrayBuffer(n.current.files[0])}},N=async e=>{for(w({message:"processing the image",processing:!0});s.current.firstChild;)s.current.removeChild(s.current.firstChild);var i=await r.Z.read(e);let n=u(i.bitmap.height/i.bitmap.width),l=new ImageData(new Uint8ClampedArray(i.bitmap.data),i.bitmap.width,i.bitmap.height),c=document.createElement("canvas");c.width=i.bitmap.width,c.height=i.bitmap.height;let a=c.getContext("2d");a.putImageData(l,0,0),t.current.src=c.toDataURL("image/png");let d=await g.instance.process(e);for(let h of(o.log("Inference finished in ".concat(d.elapsed," seconds.")),d.objects)){var m,j=document.createElementNS("http://www.w3.org/2000/svg","rect");j.setAttributeNS(null,"x",(n[0]*h.x).toString()),j.setAttributeNS(null,"y",(n[1]*h.y).toString()),j.setAttributeNS(null,"width",(n[0]*h.width).toString()),j.setAttributeNS(null,"height",(n[1]*h.height).toString());let x=h.color;j.setAttributeNS(null,"fill",x),j.setAttributeNS(null,"stroke",x),j.setAttributeNS(null,"stroke-width","2"),j.setAttributeNS(null,"fill-opacity","0.35"),null===(m=s.current)||void 0===m||m.appendChild(j)}f({results:d.objects}),w({message:"finished processing",processing:!1})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l(),{children:[(0,i.jsx)("title",{children:"Web AI Next.js object detection example"}),(0,i.jsx)("meta",{name:"description",content:"Web AI Next.js object detection example"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,i.jsx)("main",{children:(0,i.jsxs)("div",{className:"container",children:[(0,i.jsx)("div",{className:"row",children:(0,i.jsx)("div",{className:"col",children:(0,i.jsx)("h2",{children:"Object detection"})})}),(0,i.jsx)("div",{className:"row",children:(0,i.jsx)("div",{className:"col",children:(0,i.jsx)("div",{className:"d-flex align-items-center",children:(0,i.jsxs)("strong",{children:["Status: ",p.message]})})})}),(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col-md-6 col-sm-12",children:[(0,i.jsxs)("div",{ref:e,style:{position:"relative",height:d.height},children:[(0,i.jsx)("img",{ref:t,width:d.width,height:d.height,style:{position:"absolute",top:0,left:0}}),(0,i.jsx)("svg",{ref:s,width:d.width,height:d.height,style:{position:"absolute",top:0,left:0}})]}),m.results&&m.results.length>0&&(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Color"}),(0,i.jsx)("th",{children:"Class"}),(0,i.jsx)("th",{children:"Confidence"})]})}),(0,i.jsx)("tbody",{children:m.results.map((e,t)=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{backgroundColor:e.color}}),(0,i.jsx)("td",{children:e.class}),(0,i.jsx)("td",{children:Math.round(1e4*e.confidence)/1e4})]},e.class))})]})]}),(0,i.jsx)("div",{className:"col-md-6 col-sm-12",children:(0,i.jsxs)("form",{action:"#",onSubmit:e=>e.preventDefault(),children:[(0,i.jsx)("h6",{children:"Select the image"}),(0,i.jsx)("div",{className:"row",children:(0,i.jsx)("div",{className:"mb-3",children:(0,i.jsx)("input",{className:"form-control",type:"file",ref:n,onChange:b,disabled:p.processing})})})]})})]})]})})]})}},2987:function(){},8104:function(){},3731:function(){}},function(e){e.O(0,[770,655,362,444,774,888,179],function(){return e(e.s=7562)}),_N_E=e.O()}]);